<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Vida e Saúde</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pesquisas/vida_saude.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
</head>
<body class="bg-light">

    {% if admin %}
        {% include 'navbar/nav_adm.html' %}
    {% else %}
        {% include 'navbar/nav_pesq.html' %}
    {% endif %}

    <div class="d-flex justify-content-center align-items-center my-5 min-vh-100">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8 col-xl-9">

                    {% with messages = get_flashed_messages(with_categories=True) %}
                        {% if messages %}
                            <div class="flash-message text-center">
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ category }} py-4" role="alert">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}

                    <form method="POST" novalidate action="
                        {% if editar %}
                            {{ url_for('vida_saude.editar_vida_saude', id=id_pesquisa) }}
                        {% else %}
                            {{ url_for('vida_saude.coleta_dados_vida_saude', id_entrevistado=id_entrevistado, token=request.args.get('token')) }}
                        {% endif %}">

                        {{ form.hidden_tag() }}

                        <!-- INFORMAÇÕES PESSOAIS -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <div class="mb-5">
                                    <h6>{{ form.data_nasc.label }}</h6>
                                    {{ form.data_nasc(class_="form-control", autocomplete="off") }}
                                    {% for error in form.data_nasc.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.sexo.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.sexo %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.sexo.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.pele.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.pele %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.pele.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.local_nasc.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.local_nasc %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.local_nasc.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="mb-5">
                                    <h6>{{ form.cidade.label }}</h6>
                                    {{ form.cidade(class_="form-control", autocomplete="off") }}
                                    {% for error in form.cidade.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="mb-5">
                                    <h6>{{ form.estado.label }}</h6>
                                    {{ form.estado(class_="form-control", autocomplete="off") }}
                                    {% for error in form.estado.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="mb-5">
                                    <h6>{{ form.pais.label }}</h6>
                                    {{ form.pais(class_="form-control", autocomplete="off") }}
                                    {% for error in form.pais.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.local_resid.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.local_resid %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.local_resid.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="mb-5">
                                    <h6>{{ form.tempo_resid.label }}</h6>
                                    {{ form.tempo_resid(class_="form-control", autocomplete="off") }}
                                    {% for error in form.tempo_resid.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.estado_civil.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.estado_civil %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.estado_civil.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.escolaridade.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.escolaridade %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.escolaridade.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.aposentadoria.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.aposentadoria %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.aposentadoria.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div>
                                    <h6>{{ form.valor_apos.label }}</h6>
                                    {{ form.valor_apos(class_="form-control", autocomplete="off") }}
                                    {% for error in form.valor_apos.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                            </div>
                        </div>

                        <br>

                        <!-- CONDIÇÕES DE MORADIA -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.casa.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.casa %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.casa.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.esgoto.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.esgoto %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.esgoto.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.lixo.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.lixo %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.lixo.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.luz.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.luz %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.luz.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div>
                                    <h6 class="mb-3">{{ form.meios_transporte.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.meios_transporte %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.meios_transporte.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                            </div>
                        </div>

                        <br>

                        <!-- COMPOSIÇÃO FAMILIAR -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.modo_vida.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.modo_vida %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.modo_vida.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div>
                                    <h6 class="mb-3">{{ form.satisf_vida.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.satisf_vida %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.satisf_vida.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                            </div>
                        </div>

                        <br>

                        <!-- CONDIÇÕES DE SAÚDE E HÁBITOS DE VIDA -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.saude_geral.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.saude_geral %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.saude_geral.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div>
                                    <h6>{{ form.Medicamentos.label }}</h6>
                                    {{ form.Medicamentos(class_="form-control", autocomplete="off") }}
                                    {% for error in form.Medicamentos.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.motivo_uso.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.motivo_uso %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.motivo_uso.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div>
                                    <h6 class="mb-3">{{ form.aquisicao.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.aquisicao %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.aquisicao.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <br>

                        <!-- PROBLEMAS SAÚDE -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <h6 class="mb-4">No momento, você possui algum dos problemas de saúde listados a seguir? De que forma eles interferem nas suas atividades diárias?</h5>

                                <div class="table-responsive mb-0">
                                    <table class="table table-bordered text-center mb-0 align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th></th>
                                                <th>Não tenho</th>
                                                <th>Tenho, não interfere</th>
                                                <th>Tenho e interfere</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% set campos = [
                                                form.reumatismo,
                                                form.asma_bronquite,
                                                form.pressao_alta,
                                                form.varizes,
                                                form.diabetes,
                                                form.obesidade,
                                                form.derrame,
                                                form.incontinencia,
                                                form.prisao_ventre,
                                                form.insonia,
                                                form.catarata,
                                                form.problema_coluna,
                                                form.artrite_artrose,
                                                form.osteoporose,
                                                form.nervos,
                                                form.tuberculose,
                                                form.cardiaco,
                                                form.anemia,
                                                form.parkinson,
                                                form.cancer,
                                                form.alzheimer,
                                                form.depressao,
                                                form.osteomioarticulares,
                                                form.tontura,
                                                form.colesterol,
                                                form.constipacao,
                                            ] %}

                                            {% for campo in campos %}
                                            <tr>
                                                <td class="text-start text-justify">
                                                    <span class="btn btn-outline-secondary radio-text">
                                                        {{ campo.label }}
                                                    </span>
                                                </td>

                                                {% for subfield in campo %}
                                                <td>
                                                    {{ subfield(class_="form-check-input") }}
                                                </td>
                                                {% endfor %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    {% set tem_erro = campos|selectattr("errors")|list|length > 0 %}
                                    {% if tem_erro %}
                                        <p class="text-start form-text text-danger mt-3 text-nowrap">
                                            Por favor, preencha todos os campos desta seção.
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <br>

    
                        <!-- # ACESSO SERVIÇOS DE SAÚDE E APOIO FAMILIAR -->
                        <div class="card mb-5 mt-5 p-md-5">
                            <div class="card-body p-4 p-md-5">

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.cuidador.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.cuidador %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.cuidador.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.sexo_cuidador.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.sexo_cuidador %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.sexo_cuidador.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div class="mb-5">
                                    <h6 class="mb-3">{{ form.idade_cuidador.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.idade_cuidador %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.idade_cuidador.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="full-divider"></div>

                                <div>
                                    <h6 class="mb-3">{{ form.servico_saude.label }}</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        {% for subfield in form.servico_saude %}
                                            {{ subfield(class="btn-check") }}
                                            <label class="btn btn-outline-secondary" for="{{ subfield.id }}">
                                                {{ subfield.label.text }}
                                            </label>
                                        {% endfor %}
                                    </div>
                                    {% for error in form.servico_saude.errors %}
                                        <div class="form-text text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>

                        {% if not visualizar %}
                            <div class="d-flex flex-column flex-md-row gap-3 mt-4">
                                {% if editar %}
                                    <!-- BOTÃO CANCELAR PARA EDIÇÃO -->
                                    <a href="{{ url_for('pesq.minhas_pesquisas') }}"
                                        class="btn btn-outline-primary px-3 py-2 flex-fill" role="button">
                                        Cancelar
                                    </a>
                                    <button type="submit" class="btn btn-primary px-3 py-2 flex-fill">
                                        Atualizar
                                    </button>
                                {% else %}
                                    <!-- BOTÃO CANCELAR PARA NOVA PESQUISA (só pesquisador) -->
                                    <button type="button" class="btn btn-outline-primary px-3 py-2 flex-fill" onclick="document.getElementById('cancel-form').submit();">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="btn btn-primary px-3 py-2 flex-fill">
                                        Salvar
                                    </button>
                                {% endif %}
                            </div>
                        {% else %}
                            <!-- BOTÃO VOLTAR PARA VISUALIZAÇÃO -->
                            <div class="d-flex justify-content-center mt-4">
                                <a href="
                                    {% if admin %}
                                        {{ url_for('admin.visualizar_pesquisas') }}
                                    {% else %}
                                        {{ url_for('pesq.minhas_pesquisas') }}
                                    {% endif %}" 
                                    class="btn btn-primary px-3 py-2" role="button">
                                    <i class="bi bi-arrow-left"></i> Voltar
                                </a>
                            </div>
                        {% endif %}
                    </form>
                    <form id="cancel-form" method="POST" action="{{ url_for('pesq.cancelar_pesquisa') }}" style="display:none;">{{ form.hidden_tag() }}</form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</body>
</html>